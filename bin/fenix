#!/bin/bash
source "/etc/FenixManager/funciones/funciones.bash"

function check_for_update(){
    local git_remote_version=$(curl -s "https://raw.githubusercontent.com/M1001-byte/FenixManager/master/version" 2>/dev/null)
    local scr_dir="/etc/FeixManager/"
    local url="https://github.com/M1001-byte/FenixManager/"
    local zip_name="FenixManager.zip"
    local local_version=$(cat /etc/FenixManager/version 2>/dev/null)
    
    if [[ -n "${git_remote_version}" && -n "${local_version}" && "$git_remote_version" != "$local_version" ]]; then
        zip -r "${zip_name}" "${scr_dir}ip" "${scr_dir}/preferences.bash" "${scr_dir}/database" 2>/dev/null
        
        info "Hay una nueva version de FenixManager disponible."
        info "Version local: ${YELLOW}${local_version}"
        info "Version remota: ${YELLOW}${git_remote_version}"
        info "Actualizando..."
        for file in "${file_dir_[@]}"; do
            sudo mv "/etc/FenixManager/${file}" "${temp_dir}"
        done
        sudo rm -rf "/etc/FenixManager"
        sudo git clone "${url}" "/etc/FenixManager"
        unzip "/tmp/${zip_name}" -d "/etc/FenixManager/"
        sudo rm "${zip_name}"
        info "Actualizacion completada."
        info "Nueva version: ${GREEN}$(cat /etc/FenixManager/version)"
        info "Vuelva a ejecutar fenix para aplicar los cambios."
        exit 0
    fi
}

function fenix() {
    local ui_mode="$1"
    local fenix_menu="/etc/FenixManager/fenix-menu.bash"
    check_for_update
    sudo "${fenix_menu}"
}

fenix